---

typo3_ssl_certificates:
  - typo3.homestead
  - 4.5.typo3.cms
  - 4.5.39.typo3.cms
  - 6.2.typo3.cms
  - 6.2.9.typo3.cms
  - 7.0.typo3.cms
  - 7.0.2.typo3.cms
  - 1.2.typo3.neos
  - dev-master.typo3.neos

nginx_sites:
  default:
    - set $upstream hhvm
    - listen 80 default_server
    - server_name _
    - root "{{ typo3_webroot }}/typo3.homestead/"
    - "{{ nginx_fastcgi }}"
  default-ssl:
    - set $upstream php
    - listen 443 default_server
    - server_name _
    - root "{{ typo3_webroot }}/typo3.homestead/"
    - "{{ nginx_fastcgi }}"
    - ssl on
    - ssl_certificate {{nginx_conf_dir}}/ssl/typo3.homestead.crt
    - ssl_certificate_key {{nginx_conf_dir}}/ssl/typo3.homestead.key
  typo3.cms:
    - set $upstream php
    - server_name ~(?<serverNameUpstream>php|xhprof|blackfire|hhvm)?\.?(?<project>.*)\.typo3.cms$
    - if ($serverNameUpstream ~ (php|xhprof|blackfire|hhvm)) { set $upstream $serverNameUpstream; }
    - root "{{ typo3_webroot }}${project}.typo3.cms/";
    - "{{ nginx_fastcgi }}"
  typo3.neos:
    - set $upstream php
    - server_name ~(?<serverNameUpstream>php|xhprof|blackfire|hhvm)?\.?(?<project>.*)\.typo3.neos$
    - if ($serverNameUpstream ~ (php|xhprof|blackfire|hhvm)) { set $upstream $serverNameUpstream; }
    - root "{{ typo3_webroot }}${project}.typo3.neos/Web/";
    - "{{ nginx_typo3_neos_resources }}"
    - "{{ nginx_fastcgi }}"
