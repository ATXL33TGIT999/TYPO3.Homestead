---

typo3_ssl_certificates:
  - "typo3.homestead"
  - "*.typo3.cms"
  - "*.typo3.neos"

nginx_sites:
  typo3.homestead:
    - set $upstream hhvm
    - listen 80 default_server
    - server_name _
    - root "{{ typo3_webroot }}/typo3.homestead/"
    - "{{ nginx_fastcgi }}"
  typo3.homestead.ssl:
    - set $upstream php
    - listen 443 default_server
    - server_name _
    - root "{{ typo3_webroot }}/typo3.homestead/"
    - "{{ nginx_fastcgi }}"
    - ssl on
    - ssl_certificate /etc/ssl/certs/typo3.homestead.crt
    - ssl_certificate_key /etc/ssl/private/typo3.homestead.key
  typo3.cms:
    - set $upstream php
    - server_name ~(?<serverNameUpstream>php|xhprof|blackfire|hhvm)?\.?(?<project>.*)\.typo3.cms$
    - if ($serverNameUpstream ~ (php|xhprof|blackfire|hhvm)) { set $upstream $serverNameUpstream; }
    - root "{{ typo3_webroot }}${project}.typo3.cms/";
    - "{{ nginx_fastcgi }}"
#  typo3.cms.ssl:
#    - set $upstream php
#    - listen 443
#    - server_name ~(?<serverNameUpstream>php|xhprof|blackfire|hhvm)?\.?(?<project>.*)\.typo3.cms$
#    - if ($serverNameUpstream ~ (php|xhprof|blackfire|hhvm)) { set $upstream $serverNameUpstream; }
#    - root "{{ typo3_webroot }}${project}.typo3.cms/";
#    - ssl on
#    - ssl_certificate /etc/ssl/certs/typo3.cms.crt
#    - ssl_certificate_key /etc/ssl/private/typo3.cms.key
#    - "{{ nginx_fastcgi }}"
  typo3.neos:
    - set $upstream php
    - server_name ~(?<serverNameUpstream>php|xhprof|blackfire|hhvm)?\.?(?<project>.*)\.typo3.neos$
    - if ($serverNameUpstream ~ (php|xhprof|blackfire|hhvm)) { set $upstream $serverNameUpstream; }
    - root "{{ typo3_webroot }}${project}.typo3.neos/Web/";
    - "{{ nginx_typo3_neos_resources }}"
    - "{{ nginx_fastcgi }}"
#  typo3.neos.ssl:
#    - set $upstream php
#    - listen 443
#    - server_name ~(?<serverNameUpstream>php|xhprof|blackfire|hhvm)?\.?(?<project>.*)\.typo3.neos$
#    - if ($serverNameUpstream ~ (php|xhprof|blackfire|hhvm)) { set $upstream $serverNameUpstream; }
#    - root "{{ typo3_webroot }}${project}.typo3.neos/Web/";
#    - "{{ nginx_typo3_neos_resources }}"
#    - ssl on
#    - ssl_certificate /etc/ssl/certs/typo3.neos.crt
#    - ssl_certificate_key /etc/ssl/private/typo3.neos.key
#    - "{{ nginx_fastcgi }}"
